<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Earn Rewards</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="//libtl.com/sdk.js" data-zone="9687002" data-sdk="show_9687002"></script>
<style>
  body { margin:0; font-family: system-ui, sans-serif; background:#f5f7fa; }
  .header {
    background:#2ecc71; color:white; padding:15px;
    display:flex; align-items:center; gap:10px;
  }
  .avatar { width:40px; height:40px; border-radius:50%; background:#ddd; }
  .userinfo { flex:1; }
  .username { font-weight:600; font-size:1rem; }
  .balance { font-size:0.9rem; }
  h2 { color:#2ecc71; margin:20px 0 10px; text-align:center; }

  .card {
    background:white; margin:10px auto; padding:15px;
    border-radius:12px; max-width:400px;
    box-shadow:0 2px 6px rgba(0,0,0,0.05);
  }
  .row { display:flex; justify-content:space-between; margin:4px 0; }
  .progress-bar {
    height:10px; background:#e0e0e0; border-radius:5px; overflow:hidden; margin-top:8px;
  }
  .progress { height:100%; background:#2ecc71; width:0%; }
  .btn {
    display:block; width:100%; margin-top:12px; padding:10px;
    background:#1f8ef1; color:white; text-align:center;
    border:none; border-radius:8px; font-size:1rem; cursor:pointer;
  }
  .btn:disabled { background:#999; cursor:not-allowed; }
  .bottom-nav {
    position:fixed; bottom:0; left:0; right:0; background:#2ecc71;
    display:flex; justify-content:space-around; padding:8px 0; color:white;
  }
  .nav-item { text-align:center; font-size:0.8rem; }
</style>
</head>
<body>
<div class="header">
  <div class="avatar"></div>
  <div class="userinfo">
    <div class="username" id="username">David Wilson</div>
    <div class="balance"><span id="balance">0</span> VET</div>
  </div>
</div>

<h2>Earn Rewards</h2>
<div class="card">
  <div class="row"><span>Total Tasks:</span> <span id="totalTasks">30</span></div>
  <div class="row"><span>Completed:</span> <span id="completed">0</span></div>
  <div class="row"><span>Remaining:</span> <span id="remaining">30</span></div>
  <div class="progress-bar"><div class="progress" id="progress"></div></div>
  <button class="btn" id="startBtn" disabled>Loading...</button>
  <div id="status" style="margin-top:8px; font-size:0.9rem; color:#555;"></div>
</div>

<div class="bottom-nav">
  <div class="nav-item">üè†<br>Home</div>
  <div class="nav-item">üí∞<br>Earn</div>
  <div class="nav-item">üí≥<br>Withdraw</div>
  <div class="nav-item">üë§<br>Profile</div>
</div>

<script>
const MAX_TASKS = 30;
const REWARD_PER_AD = 0.5; // —Å–∫–æ–ª—å–∫–æ VET –Ω–∞—á–∏—Å–ª—è—Ç—å –∑–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä
const WAIT_TIME = 3 * 1000; // 20 —Å–µ–∫—É–Ω–¥

function setCookie(name,value,days) {
  const d = new Date();
  d.setTime(d.getTime() + (days*24*60*60*1000));
  document.cookie = name + "=" + value + ";expires=" + d.toUTCString() + ";path=/";
}
function getCookie(name) {
  let match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
  return match ? match[2] : null;
}

let balance = parseFloat(getCookie("balance")) || 0;
let completed = parseInt(getCookie("completed")) || 0;
let lastReset = getCookie("lastReset");

function resetDailyIfNeeded() {
  const today = new Date().toDateString();
  if (lastReset !== today) {
    completed = 0;
    setCookie("completed", completed, 7);
    setCookie("lastReset", today, 7);
    lastReset = today;
  }
}
resetDailyIfNeeded();

const balanceEl = document.getElementById("balance");
const completedEl = document.getElementById("completed");
const remainingEl = document.getElementById("remaining");
const progressEl = document.getElementById("progress");
const startBtn = document.getElementById("startBtn");
const statusEl = document.getElementById("status");

function updateUI() {
  balanceEl.textContent = balance.toFixed(2);
  completedEl.textContent = completed;
  remainingEl.textContent = MAX_TASKS - completed;
  progressEl.style.width = ((completed / MAX_TASKS) * 100) + "%";
}
updateUI();

// –ñ–¥–µ–º SDK
const sdkCheck = setInterval(() => {
  if (typeof window.show_9687002 === 'function') {
    clearInterval(sdkCheck);
    startBtn.disabled = false;
    startBtn.textContent = "Start Task ‚ñ∂";
  }
}, 300);

let canWatch = true;

startBtn.addEventListener("click", () => {
  resetDailyIfNeeded();
  if (!canWatch) {
    statusEl.textContent = "–ü–æ–¥–æ–∂–¥–∏—Ç–µ 20 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π —Ä–µ–∫–ª–∞–º–æ–π.";
    return;
  }
  if (completed >= MAX_TASKS) {
    statusEl.textContent = "–î–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç –∑–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω–µ–Ω.";
    return;
  }

  canWatch = false;
  startBtn.disabled = true;
  statusEl.textContent = "–ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∫–ª–∞–º—É...";

  show_9687002().then(result => {
    if (result && result.reward_event_type === 'valued') {
      completed++;
      balance += REWARD_PER_AD;
      setCookie("completed", completed, 7);
      setCookie("balance", balance, 7);
      updateUI();
      statusEl.textContent = "–†–µ–∫–ª–∞–º–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–∞! –ù–∞–≥—Ä–∞–¥–∞ –ø–æ–ª—É—á–µ–Ω–∞.";
    } else {
      statusEl.textContent = "–†–µ–∫–ª–∞–º–∞ –ø–æ–∫–∞–∑–∞–Ω–∞, –Ω–æ –±–µ–∑ –Ω–∞–≥—Ä–∞–¥—ã.";
    }
  }).catch(err => {
    statusEl.textContent = "–û—à–∏–±–∫–∞ –ø–æ–∫–∞–∑–∞ —Ä–µ–∫–ª–∞–º—ã: " + err.message;
  }).finally(() => {
    setTimeout(() => {
      canWatch = true;
      if (completed < MAX_TASKS) startBtn.disabled = false;
    }, WAIT_TIME);
  });
});
</script>
</body>
</html>
